# City Clock Plugin - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
**–§–∞–π–ª**: `src/asyncwebserver.cpp`
- ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ –±—ã–ª–æ HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ City Clock
- ‚úÖ **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/cityclock` —Å —Ñ–æ—Ä–º–∞—Ç–æ–º, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º Marquee
- **–§—É–Ω–∫—Ü–∏–∏**:
  - –í–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–∞
  - –í–≤–æ–¥ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ (POSIX —Ñ–æ—Ä–º–∞—Ç)
  - WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞
  - –ü—Ä–∏–º–µ—Ä—ã –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –∏ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤

### 2. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ WebSocket
**–§–∞–π–ª**: `src/websocket.cpp`
- ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞**: –ë—ã–ª–∏ –ª–∏—à–Ω–∏–µ —Å–∫–æ–±–∫–∏ –∏ –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è `sendInfo()`
- ‚úÖ **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 
  - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `marquee` –∏ `cityclock` —Å–æ–±—ã—Ç–∏–π
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º hook

### 3. –£–ª—É—á—à–µ–Ω –ø–ª–∞–≥–∏–Ω CityClockPlugin
**–§–∞–π–ª**: `src/plugins/CityClockPlugin.cpp`
- ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞ —ç–∫—Ä–∞–Ω –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è —Å—Ä–∞–∑—É
- ‚úÖ **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
- **–£–ª—É—á—à–µ–Ω–∏—è**:
  - `secondTimer.forceReady()` - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
  - –°–±—Ä–æ—Å –∫—ç—à–∞ –ø–æ–≥–æ–¥—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≥–æ—Ä–æ–¥–∞
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ Preferences (NVS)

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
**–§–∞–π–ª—ã**: 
- `CITYCLOCK_GUIDE.md` - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
- `CITYCLOCK_GUIDE_RU.md` - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**:
- –û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –ø–ª–∞–≥–∏–Ω–∞
- Step-by-step –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –°–ø–∏—Å–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –∏ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤
- –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ü—Ä–∏–º–µ—Ä—ã –≥–æ—Ç–æ–≤—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- –¢–∞–±–ª–∏—Ü—ã —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤
- –†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üìã –°–ø–∏—Å–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –≥–æ—Ä–æ–¥–æ–≤

### –ö–∞–∫ –Ω–∞–π—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –≥–æ—Ä–æ–¥–∞
1. –ì–æ—Ä–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è API [wttr.in](https://wttr.in/)
3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ –≥–æ—Ä–æ–¥–∞ –º–∏—Ä–∞

### –ü—Ä–∏–º–µ—Ä—ã:
- ‚úÖ `London`, `London, UK`
- ‚úÖ `Tokyo`, `Tokyo, Japan`
- ‚úÖ `New York`
- ‚úÖ `Sydney`
- ‚úÖ `Moscow`
- ‚ùå `–õ–æ–Ω–¥–æ–Ω` (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `London`)
- ‚ùå `–ú–æ—Å–∫–≤–∞` (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Moscow`)

---

## üïê –§–æ—Ä–º–∞—Ç —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ (POSIX)

### –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã:
```
UTC0          - UTC (—ç—Ç–∞–ª–æ–Ω–Ω—ã–π)
GMT0          - –õ–æ–Ω–¥–æ–Ω
MSK-3         - –ú–æ—Å–∫–≤–∞ (UTC+3)
JST-9         - –Ø–ø–æ–Ω–∏—è (UTC+9)
```

### –° –ø–µ—Ä–µ–≤–æ–¥–æ–º –Ω–∞ –ª–µ—Ç–Ω–µ–µ –≤—Ä–µ–º—è (DST):
```
CET-1CEST,M3.5.0,M10.5.0/3     - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ï–≤—Ä–æ–ø–∞ (UTC+1)
EST5EDT,M3.2.0,M11.1.0         - –í–æ—Å—Ç–æ—á–Ω–∞—è –°–®–ê (UTC-5)
AEST-10AEDT,M10.1.0,M4.1.0/3   - –°–∏–¥–Ω–µ–π (UTC+10)
```

### –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞:
- `CET` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
- `-1` - —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç UTC (CET —ç—Ç–æ UTC+1, –ø–æ—ç—Ç–æ–º—É -1)
- `CEST` - –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–µ—Ç–Ω–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- `M3.5.0` - –º–∞—Ä—Ç (3), –ø—è—Ç–∞—è –Ω–µ–¥–µ–ª—è, –≤—Ç–æ—Ä–Ω–∏–∫ (0)
- `M10.5.0/3` - –æ–∫—Ç—è–±—Ä—å (10), –ø—è—Ç–∞—è –Ω–µ–¥–µ–ª—è, –≤—Ç–æ—Ä–Ω–∏–∫ –≤ 3:00

---

## üå°Ô∏è –ò–∫–æ–Ω–∫–∏ –ø–æ–≥–æ–¥—ã

| –ó–Ω–∞—á–µ–Ω–∏–µ | –£—Å–ª–æ–≤–∏–µ |
|----------|---------|
| 0 | ‚òÅÔ∏è –û–±–ª–∞—á–Ω–æ |
| 1 | ‚õàÔ∏è –ì—Ä–æ–∑–∞ |
| 2 | ‚òÄÔ∏è –Ø—Å–Ω–æ (–¥–µ–Ω—å) |
| 3 | üå§Ô∏è –û–±–ª–∞—á–Ω–æ (—á–∞—Å—Ç–∏—á–Ω–æ) |
| 4 | üåßÔ∏è –î–æ–∂–¥—å |
| 5 | ‚ùÑÔ∏è –°–Ω–µ–≥ |
| 6 | üå´Ô∏è –¢—É–º–∞–Ω |
| 7 | üåô –Ø—Å–Ω–æ (–Ω–æ—á—å) |

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –ü–æ–≥–æ–¥–∞: –∫–∞–∂–¥—ã–µ 600 —Å–µ–∫—É–Ω–¥ (10 –º–∏–Ω—É—Ç)
- –í—Ä–µ–º—è: –∫–∞–∂–¥—ã–µ 500–º—Å (–¥–ª—è –º–∏–≥–∞–Ω–∏—è –¥–≤–æ–µ—Ç–æ—á–∏—è)
- –ì–æ—Ä–æ–¥—Å–∫–æ–µ –∏–º—è: –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–∞–∂–¥—ã–µ 40–º—Å

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- **–í—Ä–µ–º—è**: RTC —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ + NTP —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- **–ü–æ–≥–æ–¥–∞**: wttr.in API (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å)
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: Preferences (NVS flash –ø–∞–º—è—Ç–∏)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ç–∏
- WiFi –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–≥–æ–¥—ã)
- –î–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
- NTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏

---

## üì± WebSocket API

## –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```json
{
  "event": "cityclock",
  "city": "London",
  "tz": "GMT0",
  "plugin": 7
}
```

## –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```
GET /api/cityclock
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "city": "London",
  "tz": "GMT0"
}
```

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–¢–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–æ–≤** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –∏–º–µ–Ω–∞ –≥–æ—Ä–æ–¥–∞ –¥–ª—è API
2. **–ü–æ–≥–æ–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç** - –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
3. **–¢—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç** - –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–≥–æ–¥—ã
4. **–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π** - –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –ª–µ—Ç–Ω–∏–º –≤—Ä–µ–º–µ–Ω–µ–º (–Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å)

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:
1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://{IP}/cityclock`
2. –í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥: `London`
3. –í–≤–µ–¥–∏—Ç–µ —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å: `GMT0`
4. –ù–∞–∂–º–∏—Ç–µ "Set City"
5. –ì–æ—Ç–æ–≤–æ! –í—Ä–µ–º—è –∏ –ø–æ–≥–æ–¥–∞ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –Ω–∞ –º–∞—Ç—Ä–∏—Ü–µ

### –°–º–µ–Ω–∞ –≥–æ—Ä–æ–¥–∞:
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/cityclock` —Å–Ω–æ–≤–∞
2. –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
3. –ù–∞–∂–º–∏—Ç–µ "Set City"
4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–∏—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- [ ] –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ WiFi
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ (`/config` ‚Üí NTP Server)
- [ ] –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
- [ ] –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –≤ —Ñ–æ—Ä–º–∞—Ç–µ POSIX
- [ ] –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–≥–æ–¥—ã
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ (–Ω–∞–∂–∞—Ç–∞ "Set City")

